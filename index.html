<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>오늘의 행운 로또 생성기</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: #121a30;
      --line: #263554;
      --text: #eaf1ff;
      --muted: #a7b6d8;
      --accent: #f59e0b;
      --subaccent: #38bdf8;
      --ok: #22c55e;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Noto Sans KR", "Segoe UI", sans-serif;
      color: var(--text);
      background:
        radial-gradient(900px 500px at 15% 0%, rgba(245, 158, 11, .20), transparent 60%),
        radial-gradient(900px 600px at 85% 10%, rgba(56, 189, 248, .16), transparent 60%),
        var(--bg);
      display: grid;
      place-items: center;
      padding: 16px;
    }
    .app {
      width: min(980px, 100%);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    h1 { margin: 0 0 8px; font-size: 30px; }
    .sub { margin: 0 0 14px; color: var(--muted); font-size: 14px; line-height: 1.5; }
    .grid {
      display: grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 12px;
    }
    @media (max-width: 860px) { .grid { grid-template-columns: 1fr; } }
    .panel {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(8, 13, 25, .66);
      padding: 12px;
    }
    .form {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }
    .form .full { grid-column: 1 / -1; }
    label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    input, select, button {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
      background: #0b1222;
      color: var(--text);
      font-size: 14px;
    }
    button { cursor: pointer; font-weight: 700; }
    .btnrow { display: flex; gap: 8px; }
    .btnrow button { width: auto; }
    .primary {
      background: rgba(245, 158, 11, .20);
      border-color: rgba(245, 158, 11, .55);
    }
    .ghost { color: var(--muted); }
    .result {
      margin-top: 10px;
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 10px;
      min-height: 94px;
      background: rgba(11, 18, 34, .7);
    }
    .line {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      margin: 8px 0;
    }
    .lineTag { width: 28px; color: var(--muted); font-size: 13px; }
    .ball {
      width: 38px;
      height: 38px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      font-weight: 800;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      box-shadow: 0 8px 20px rgba(0,0,0,.25);
    }
    .plus { color: var(--muted); }
    .meta { margin-top: 10px; color: var(--muted); font-size: 13px; line-height: 1.5; }
    .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
    .chip {
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      background: rgba(255,255,255,.03);
      color: var(--muted);
    }
    .ok { color: var(--ok); }
    .accent { color: var(--accent); }
  </style>
</head>
<body>
  <main class="app">
    <h1>오늘의 행운 로또 번호 생성기</h1>
    <p class="sub">사주/운세 컨셉으로 날짜와 입력값을 조합해 번호를 추천합니다. 재미용 도구이며 당첨을 보장하지 않습니다.</p>

    <div class="grid">
      <section class="panel">
        <div class="form">
          <div>
            <label for="targetDate">기준 날짜</label>
            <input id="targetDate" type="date" />
          </div>
          <div>
            <label for="birthDate">생년월일(선택)</label>
            <input id="birthDate" type="date" />
          </div>
          <div>
            <label for="userName">이름(선택)</label>
            <input id="userName" type="text" placeholder="예: 홍길동" maxlength="30" />
          </div>
          <div>
            <label for="lineCount">생성 줄 수</label>
            <select id="lineCount">
              <option value="1">1줄</option>
              <option value="3" selected>3줄</option>
              <option value="5">5줄</option>
            </select>
          </div>
          <div class="full">
            <label for="mode">생성 방식</label>
            <select id="mode">
              <option value="fortune" selected>행운 모드 (사주/운세 컨셉)</option>
              <option value="random">랜덤 모드 (완전 무작위)</option>
            </select>
          </div>
        </div>

        <div class="btnrow" style="margin-top:10px;">
          <button id="genBtn" class="primary" type="button">번호 생성</button>
          <button id="copyBtn" class="ghost" type="button" disabled>결과 복사</button>
        </div>

        <div id="result" class="result" aria-live="polite"></div>
        <p id="status" class="meta">아직 생성된 결과가 없습니다.</p>
      </section>

      <aside class="panel">
        <strong>오늘 운세 요약</strong>
        <div class="chips" id="fortuneChips"></div>
        <p id="fortuneDesc" class="meta">날짜를 기준으로 오행/띠 성향을 계산해 가중치를 적용합니다.</p>
        <p class="meta"><span class="accent">참고:</span> 이 추천은 통계적 당첨 예측이 아닌 엔터테인먼트용입니다.</p>
      </aside>
    </div>
  </main>

  <script>
    const $ = (id) => document.getElementById(id);
    const zodiac = ["쥐", "소", "호랑이", "토끼", "용", "뱀", "말", "양", "원숭이", "닭", "개", "돼지"];
    const elements = ["목", "화", "토", "금", "수"];

    let lastText = "";

    function initDate() {
      const now = new Date();
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth() + 1).padStart(2, "0");
      const dd = String(now.getDate()).padStart(2, "0");
      $("targetDate").value = `${yyyy}-${mm}-${dd}`;
    }

    function xmur3(str) {
      let h = 1779033703 ^ str.length;
      for (let i = 0; i < str.length; i++) {
        h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
        h = (h << 13) | (h >>> 19);
      }
      return function () {
        h = Math.imul(h ^ (h >>> 16), 2246822507);
        h = Math.imul(h ^ (h >>> 13), 3266489909);
        return (h ^= h >>> 16) >>> 0;
      };
    }

    function mulberry32(a) {
      return function () {
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }

    function randInt(rng, min, max) {
      return Math.floor(rng() * (max - min + 1)) + min;
    }

    function colorHint(num) {
      if (num <= 10) return "rgba(245, 158, 11, .26)";
      if (num <= 20) return "rgba(59, 130, 246, .24)";
      if (num <= 30) return "rgba(239, 68, 68, .22)";
      if (num <= 40) return "rgba(34, 197, 94, .22)";
      return "rgba(156, 163, 175, .22)";
    }

    function zodiacIndex(year) {
      return ((year - 4) % 12 + 12) % 12;
    }

    function dayKey(dateStr) {
      const d = new Date(dateStr + "T00:00:00");
      return Math.floor(d.getTime() / 86400000);
    }

    function weightedUniquePick(rng, count, weights) {
      const picked = new Set();
      while (picked.size < count) {
        let total = 0;
        for (let n = 1; n <= 45; n++) {
          if (!picked.has(n)) total += weights[n];
        }
        let r = rng() * total;
        for (let n = 1; n <= 45; n++) {
          if (picked.has(n)) continue;
          r -= weights[n];
          if (r <= 0) {
            picked.add(n);
            break;
          }
        }
      }
      return Array.from(picked);
    }

    function fortuneProfile(targetDate, birthDate, name) {
      const y = Number(targetDate.slice(0, 4));
      const zToday = zodiac[zodiacIndex(y)];
      const el = elements[((y + dayKey(targetDate)) % 5 + 5) % 5];
      const by = birthDate ? Number(birthDate.slice(0, 4)) : y;
      const zBirth = zodiac[zodiacIndex(by)];
      const key = dayKey(targetDate);

      const zodiacFav = {
        "쥐": [1, 13, 25, 37], "소": [2, 14, 26, 38], "호랑이": [3, 15, 27, 39],
        "토끼": [4, 16, 28, 40], "용": [5, 17, 29, 41], "뱀": [6, 18, 30, 42],
        "말": [7, 19, 31, 43], "양": [8, 20, 32, 44], "원숭이": [9, 21, 33, 45],
        "닭": [10, 22, 34], "개": [11, 23, 35], "돼지": [12, 24, 36]
      };

      const elementMod = {
        "목": [1, 6], "화": [2, 7], "토": [3, 8], "금": [4, 9], "수": [0, 5]
      };

      const favored = new Set();
      zodiacFav[zToday].forEach((n) => favored.add(n));
      zodiacFav[zBirth].forEach((n) => favored.add(n));
      for (let n = 1; n <= 45; n++) {
        if (elementMod[el].includes(n % 10)) favored.add(n);
      }
      const dayFav = ((key % 45) + 45) % 45 + 1;
      favored.add(dayFav);

      return {
        zToday,
        zBirth,
        el,
        favored: Array.from(favored).sort((a, b) => a - b).slice(0, 16),
        seedBase: `${targetDate}|${birthDate || "none"}|${name || "anon"}|${zToday}|${zBirth}|${el}|${key}`
      };
    }

    function generateLineFortune(profile, idx) {
      const seedFn = xmur3(profile.seedBase + `|${idx}`);
      const rng = mulberry32(seedFn());
      const weights = Array(46).fill(1);
      for (let n = 1; n <= 45; n++) {
        weights[n] = 1 + rng() * 0.2;
      }
      profile.favored.forEach((n) => {
        weights[n] += 1.15;
      });
      const picked = weightedUniquePick(rng, 7, weights);
      const main = picked.slice(0, 6).sort((a, b) => a - b);
      const bonus = picked[6];
      return { main, bonus };
    }

    function generateLineRandom() {
      const set = new Set();
      while (set.size < 7) set.add(Math.floor(Math.random() * 45) + 1);
      const arr = Array.from(set);
      return {
        main: arr.slice(0, 6).sort((a, b) => a - b),
        bonus: arr[6]
      };
    }

    function makeBall(n) {
      const b = document.createElement("span");
      b.className = "ball";
      b.textContent = n;
      b.style.background = `linear-gradient(180deg, ${colorHint(n)}, rgba(11,18,34,.80))`;
      return b;
    }

    function render(lines) {
      const el = $("result");
      el.innerHTML = "";
      lines.forEach((line, i) => {
        const row = document.createElement("div");
        row.className = "line";

        const tag = document.createElement("span");
        tag.className = "lineTag";
        tag.textContent = `${i + 1}줄`;
        row.appendChild(tag);

        line.main.forEach((n) => row.appendChild(makeBall(n)));

        const plus = document.createElement("span");
        plus.className = "plus";
        plus.textContent = "+";
        row.appendChild(plus);

        row.appendChild(makeBall(line.bonus));
        el.appendChild(row);
      });
    }

    function toText(lines) {
      return lines.map((line, i) => `${i + 1}줄: ${line.main.join(", ")} + ${line.bonus}`).join("\n");
    }

    function renderFortune(profile, mode) {
      const chips = $("fortuneChips");
      chips.innerHTML = "";

      const list = mode === "fortune"
        ? [`오늘 띠 ${profile.zToday}`, `기준 오행 ${profile.el}`, `개인 띠 ${profile.zBirth}`, `행운 후보 ${profile.favored.slice(0, 6).join(", ")}`]
        : ["랜덤 모드", "오행/띠 가중치 미적용"];

      list.forEach((t) => {
        const c = document.createElement("span");
        c.className = "chip";
        c.textContent = t;
        chips.appendChild(c);
      });

      $("fortuneDesc").textContent = mode === "fortune"
        ? "입력한 날짜, 생년월일, 이름을 바탕으로 시드와 가중치를 만들어 번호를 추천합니다."
        : "완전 무작위로 번호를 생성합니다.";
    }

    async function copyResult() {
      if (!lastText) return;
      try {
        await navigator.clipboard.writeText(lastText);
      } catch {
        const ta = document.createElement("textarea");
        ta.value = lastText;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
      }
      $("status").innerHTML = `<span class="ok">복사 완료</span> - 클립보드에 저장했습니다.`;
    }

    function generate() {
      const targetDate = $("targetDate").value;
      if (!targetDate) {
        $("status").textContent = "기준 날짜를 입력해주세요.";
        return;
      }

      const birthDate = $("birthDate").value;
      const name = $("userName").value.trim();
      const lineCount = Number($("lineCount").value);
      const mode = $("mode").value;
      const profile = fortuneProfile(targetDate, birthDate, name);

      const lines = [];
      for (let i = 0; i < lineCount; i++) {
        lines.push(mode === "fortune" ? generateLineFortune(profile, i) : generateLineRandom());
      }

      render(lines);
      renderFortune(profile, mode);

      lastText = toText(lines);
      $("copyBtn").disabled = false;
      $("status").innerHTML = `<span class="ok">생성 완료</span> - ${new Date().toLocaleString("ko-KR")}`;
    }

    initDate();
    $("genBtn").addEventListener("click", generate);
    $("copyBtn").addEventListener("click", copyResult);
  </script>
</body>
</html>
